name: Sync src from A_repo to B_repo

on:
  workflow_dispatch:
  push:

permissions:
  contents: write
  actions: write

jobs:
  push-src-to-b-repo:
    runs-on: ubuntu-latest

    env:
      TARGET_REPO: MURAO1120/B_repo
      FEATURE_BRANCH: feature/signal-ci
      WORKDIR: ${{ github.workspace }}/b-repo

    steps:
      # A_repo をチェックアウト
      - name: Checkout A_repo
        uses: actions/checkout@v4

      # Git 設定
      - name: Configure git
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "github-actions@users.noreply.github.com"

      # B_repo をクローンして main をチェックアウト
      - name: Clone B_repo
        run: |
          git clone https://github.com/${{ env.TARGET_REPO }} $WORKDIR
          cd $WORKDIR
          git fetch origin main
          git checkout main || git checkout -b main

      # feature ブランチを作成 or リセット
      - name: Prepare feature branch
        run: |
          cd $WORKDIR
          if git ls-remote --exit-code --heads origin $FEATURE_BRANCH; t_
